<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Blast</title>
<style>
body{
    background:#0b0f1a;
    color:white;
    font-family:sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
.game{
    background:#111;
    padding:20px;
    border-radius:16px;
    width:350px;
}
h2{text-align:center;color:#00f7ff;}
.board{
    display:grid;
    grid-template-columns:repeat(8,1fr);
    gap:6px;
    margin:15px 0;
}
.cell{
    width:36px;
    height:36px;
    background:#1f1f1f;
    border-radius:6px;
}
.cell.filled{
    background:linear-gradient(145deg,#00f7ff,#5bffff);
    box-shadow:0 0 8px #00f7ff;
}
.blocks{
    display:flex;
    justify-content:space-between;
}
.block{
    display:grid;
    gap:4px;
    cursor:pointer;
}
.block div{
    width:28px;
    height:28px;
    background:#ff4df0;
    border-radius:5px;
}
.selected{outline:3px solid yellow;}
</style>
</head>
<body>

<div class="game">
    <h2>BLOCK BLAST</h2>
    <div>คะแนน: <span id="score">0</span></div>

    <div class="board" id="board"></div>
    <div class="blocks" id="blocks"></div>
</div>

<script>
const board = document.getElementById("board");
const blocksDiv = document.getElementById("blocks");
const scoreEl = document.getElementById("score");

let grid = Array(64).fill(0);
let score = 0;
let selectedShape = null;

const shapes = [
    [[1,1,1]],
    [[1],[1],[1]],
    [[1,1],[1,1]],
    [[1,1,1],[0,1,0]],
    [[1,1,1,1]],
    [[1],[1]]
];

function drawBoard(){
    board.innerHTML="";
    grid.forEach((v,i)=>{
        const c=document.createElement("div");
        c.className="cell"+(v?" filled":"");
        c.onclick=()=>place(i);
        board.appendChild(c);
    });
}

function randomUniqueShapes(){
    let pool=[...shapes];
    let result=[];
    for(let i=0;i<3;i++){
        const r=Math.floor(Math.random()*pool.length);
        result.push(pool[r]);
        pool.splice(r,1);
    }
    return result;
}

function newBlocks(){
    blocksDiv.innerHTML="";
    selectedShape=null;

    const set = randomUniqueShapes();

    set.forEach(shape=>{
        const b=document.createElement("div");
        b.className="block";
        b.onclick=()=>{
            document.querySelectorAll(".block").forEach(x=>x.classList.remove("selected"));
            b.classList.add("selected");
            selectedShape=shape;
        };
        shape.forEach(r=>{
            r.forEach(v=>{
                if(v){
                    const d=document.createElement("div");
                    b.appendChild(d);
                }
            });
        });
        blocksDiv.appendChild(b);
    });
}

function place(index){
    if(!selectedShape) return;

    const r=Math.floor(index/8);
    const c=index%8;

    for(let y=0;y<selectedShape.length;y++){
        for(let x=0;x<selectedShape[y].length;x++){
            if(selectedShape[y][x]){
                let i=(r+y)*8+(c+x);
                if(i>=64||grid[i]) return;
            }
        }
    }

    for(let y=0;y<selectedShape.length;y++){
        for(let x=0;x<selectedShape[y].length;x++){
            if(selectedShape[y][x]){
                grid[(r+y)*8+(c+x)]=1;
            }
        }
    }

    score+=10;
    scoreEl.textContent=score;

    clearLine();
    drawBoard();
    newBlocks();

    if(!canPlaceAny()){
        alert("เกมโอเวอร์! คะแนนถูกรีเซ็ต");
        grid=Array(64).fill(0);
        score=0;
        scoreEl.textContent=0;
        drawBoard();
        newBlocks();
    }
}

function clearLine(){
    for(let r=0;r<8;r++){
        if(grid.slice(r*8,r*8+8).every(v=>v)){
            for(let i=r*8;i<r*8+8;i++) grid[i]=0;
            score+=50;
        }
    }
}

function canPlaceAny(){
    for(let i=0;i<64;i++){
        for(let s of shapes){
            let ok=true;
            const r=Math.floor(i/8);
            const c=i%8;
            for(let y=0;y<s.length;y++){
                for(let x=0;x<s[y].length;x++){
                    if(s[y][x]){
                        let idx=(r+y)*8+(c+x);
                        if(idx>=64||grid[idx]) ok=false;
                    }
                }
            }
            if(ok) return true;
        }
    }
    return false;
}

drawBoard();
newBlocks();
</script>
</body>
</html>
