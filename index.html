<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pop World</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
    margin: 0;
    background: #ffc0cb;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    font-family: sans-serif;
}

img {
    width: 280px;
    cursor: pointer;
}

.counter {
    margin-top: 10px;
    font-size: 22px;
    font-weight: bold;
}

.board {
    background: white;
    padding: 15px;
    border-radius: 15px;
    margin-top: 15px;
    width: 260px;
}
</style>
</head>
<body>

<img id="img" src="https://media.discordapp.net/attachments/1351475770370953226/1465184686492880937/Messenger_creation_9299DE20-9320-4418-8D2A-613E2737FF97.jpg">

<div class="counter">ğŸŒ à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: <span id="total">0</span></div>

<div class="board" id="board">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>

<script>
const firebaseConfig = {
  apiKey: "à¹ƒà¸ªà¹ˆà¸‚à¸­à¸‡à¸„à¸¸à¸“",
  authDomain: "à¹ƒà¸ªà¹ˆà¸‚à¸­à¸‡à¸„à¸¸à¸“",
  projectId: "à¹ƒà¸ªà¹ˆà¸‚à¸­à¸‡à¸„à¸¸à¸“",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const img = document.getElementById("img");
const totalEl = document.getElementById("total");
const boardEl = document.getElementById("board");

const country = "TH"; // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹„à¸”à¹‰

const docRef = db.collection("pop").doc("global");

async function init() {
    const doc = await docRef.get();
    if (!doc.exists) {
        await docRef.set({
            total: 0,
            countries: {
                TH: 0,
                JP: 0,
                US: 0,
                KR: 0
            }
        });
    }
}

async function pop() {
    img.src = "https://media.discordapp.net/attachments/1351475770370953226/1465184695624142919/Messenger_creation_4466CA51-C0A8-42D0-962E-A575370349F1.jpg";

    setTimeout(() => {
        img.src = "https://media.discordapp.net/attachments/1351475770370953226/1465184686492880937/Messenger_creation_9299DE20-9320-4418-8D2A-613E2737FF97.jpg";
    }, 80);

    await docRef.update({
        total: firebase.firestore.FieldValue.increment(1),
        [`countries.${country}`]: firebase.firestore.FieldValue.increment(1)
    });
}

img.addEventListener("mousedown", pop);
img.addEventListener("touchstart", pop);

docRef.onSnapshot(doc => {
    const data = doc.data();
    totalEl.textContent = data.total;

    boardEl.innerHTML = `
    ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢: ${data.countries.TH}<br>
    ğŸ‡¯ğŸ‡µ à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™: ${data.countries.JP}<br>
    ğŸ‡ºğŸ‡¸ à¸­à¹€à¸¡à¸£à¸´à¸à¸²: ${data.countries.US}<br>
    ğŸ‡°ğŸ‡· à¹€à¸à¸²à¸«à¸¥à¸µ: ${data.countries.KR}
    `;
});

init();
</script>

</body>
</html>
