ฃ<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Candy Crush Mini</title>
<style>
    body { font-family:sans-serif; display:flex; flex-direction:column; align-items:center; background:#ffe6f0; margin:0; padding:0; }
    #score { font-size:24px; margin:10px; color:#ff3366; font-weight:bold; }
    #gameBoard { display:grid; grid-template-columns: repeat(8, 50px); grid-template-rows: repeat(8, 50px); gap:2px; }
    .candy { width:50px; height:50px; border-radius:10px; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:24px; cursor:pointer; transition:0.2s; }
</style>
</head>
<body>

<div id="score">คะแนน: 0</div>
<div id="gameBoard"></div>

<script>
const colors = ['#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff'];
const boardSize = 8;
let board = [];
let score = 0;
let selected = null;
const boardEl = document.getElementById('gameBoard');
const scoreEl = document.getElementById('score');

// สร้างบอร์ด
function initBoard() {
    board = [];
    boardEl.innerHTML = '';
    for(let r=0;r<boardSize;r++){
        let row = [];
        for(let c=0;c<boardSize;c++){
            let color = colors[Math.floor(Math.random()*colors.length)];
            let candy = document.createElement('div');
            candy.classList.add('candy');
            candy.style.background = color;
            candy.dataset.row = r;
            candy.dataset.col = c;
            candy.addEventListener('click', () => selectCandy(r,c));
            boardEl.appendChild(candy);
            row.push(color);
        }
        board.push(row);
    }
}

// เลือกและสลับลูกกวาด
function selectCandy(r,c){
    if(!selected){
        selected = {r,c};
    } else {
        if(isAdjacent(selected,{r,c})){
            swap(selected,{r,c});
            selected = null;
        } else {
            selected = {r,c};
        }
    }
}

// ตรวจว่าติดกันหรือไม่
function isAdjacent(a,b){
    return (Math.abs(a.r-b.r) + Math.abs(a.c-b.c)) === 1;
}

// สลับลูกกวาด
function swap(a,b){
    let temp = board[a.r][a.c];
    board[a.r][a.c] = board[b.r][b.c];
    board[b.r][b.c] = temp;
    renderBoard();
    setTimeout(() => {
        if(!checkMatches()){
            // ถ้าไม่ match กลับสลับ
            temp = board[a.r][a.c];
            board[a.r][a.c] = board[b.r][b.c];
            board[b.r][b.c] = temp;
            renderBoard();
        }
    }, 200);
}

// วาดบอร์ด
function renderBoard(){
    for(let r=0;r<boardSize;r++){
        for(let c=0;c<boardSize;c++){
            const candy = boardEl.children[r*boardSize + c];
            candy.style.background = board[r][c];
        }
    }
}

// ตรวจ match 3+
function checkMatches(){
    let matchFound = false;
    let remove = [];
    // แถว
    for(let r=0;r<boardSize;r++){
        for(let c=0;c<boardSize-2;c++){
            if(board[r][c]===board[r][c+1] && board[r][c]===board[r][c+2]){
                matchFound = true;
                remove.push([r,c],[r,c+1],[r,c+2]);
            }
        }
    }
    // คอลัมน์
    for(let c=0;c<boardSize;c++){
        for(let r=0;r<boardSize-2;r++){
            if(board[r][c]===board[r+1][c] && board[r][c]===board[r+2][c]){
                matchFound = true;
                remove.push([r,c],[r+1,c],[r+2,c]);
            }
        }
    }
    if(matchFound){
        remove.forEach(([r,c])=>{
            board[r][c] = '';
            score += 10;
        });
        scoreEl.innerText = 'คะแนน: ' + score;
        collapseBoard();
    }
    return matchFound;
}

// ให้ลูกกวาดตกลงมา
function collapseBoard(){
    for(let c=0;c<boardSize;c++){
        let empty = 0;
        for(let r=boardSize-1;r>=0;r--){
            if(board[r][c]==='') empty++;
            else if(empty>0){
                board[r+empty][c] = board[r][c];
                board[r][c] = '';
            }
        }
        // เติมลูกกวาดใหม่
        for(let r=0;r<empty;r++){
            board[r][c] = colors[Math.floor(Math.random()*colors.length)];
        }
    }
    renderBoard();
    setTimeout(checkMatches, 200);
}

initBoard();
renderBoard();
</script>

</body>
</html>
