<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Candy Crush Fruit</title>
<style>
    body { font-family:sans-serif; display:flex; flex-direction:column; align-items:center; background:#ffe6f0; margin:0; padding:0; }
    #score { font-size:24px; margin:10px; color:#ff3366; font-weight:bold; }
    #gameBoard { display:grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); gap:2px; }
    .candy { width:60px; height:60px; border-radius:10px; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:36px; cursor:pointer; transition:0.2s; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
</style>
</head>
<body>

<div id="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</div>
<div id="gameBoard"></div>

<script>
const fruits = ['üçé','üçå','üçá','üçì','üçç']; // ‡∏ú‡∏•‡πÑ‡∏°‡πâ
const boardSize = 8;
let board = [];
let score = 0;
let selected = null;
const boardEl = document.getElementById('gameBoard');
const scoreEl = document.getElementById('score');

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î
function initBoard() {
    board = [];
    boardEl.innerHTML = '';
    for(let r=0;r<boardSize;r++){
        let row = [];
        for(let c=0;c<boardSize;c++){
            let fruit = fruits[Math.floor(Math.random()*fruits.length)];
            let candy = document.createElement('div');
            candy.classList.add('candy');
            candy.innerText = fruit;
            candy.dataset.row = r;
            candy.dataset.col = c;
            candy.addEventListener('click', () => selectCandy(r,c));
            boardEl.appendChild(candy);
            row.push(fruit);
        }
        board.push(row);
    }
}

// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Å‡∏ß‡∏≤‡∏î
function selectCandy(r,c){
    if(!selected){
        selected = {r,c};
    } else {
        if(isAdjacent(selected,{r,c})){
            swap(selected,{r,c});
            selected = null;
        } else {
            selected = {r,c};
        }
    }
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
function isAdjacent(a,b){
    return (Math.abs(a.r-b.r) + Math.abs(a.c-b.c)) === 1;
}

// ‡∏™‡∏•‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Å‡∏ß‡∏≤‡∏î
function swap(a,b){
    let temp = board[a.r][a.c];
    board[a.r][a.c] = board[b.r][b.c];
    board[b.r][b.c] = temp;
    renderBoard();
    setTimeout(() => {
        if(!checkMatches()){
            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà match ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏•‡∏±‡∏ö
            temp = board[a.r][a.c];
            board[a.r][a.c] = board[b.r][b.c];
            board[b.r][b.c] = temp;
            renderBoard();
        }
    }, 200);
}

// ‡∏ß‡∏≤‡∏î‡∏ö‡∏≠‡∏£‡πå‡∏î
function renderBoard(){
    for(let r=0;r<boardSize;r++){
        for(let c=0;c<boardSize;c++){
            const candy = boardEl.children[r*boardSize + c];
            candy.innerText = board[r][c];
        }
    }
}

// ‡∏ï‡∏£‡∏ß‡∏à match 3+
function checkMatches(){
    let matchFound = false;
    let remove = [];
    // ‡πÅ‡∏ñ‡∏ß
    for(let r=0;r<boardSize;r++){
        for(let c=0;c<boardSize-2;c++){
            if(board[r][c]!=='' && board[r][c]===board[r][c+1] && board[r][c]===board[r][c+2]){
                matchFound = true;
                remove.push([r,c],[r,c+1],[r,c+2]);
            }
        }
    }
    // ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    for(let c=0;c<boardSize;c++){
        for(let r=0;r<boardSize-2;r++){
            if(board[r][c]!=='' && board[r][c]===board[r+1][c] && board[r][c]===board[r+2][c]){
                matchFound = true;
                remove.push([r,c],[r+1,c],[r+2,c]);
            }
        }
    }
    if(matchFound){
        remove.forEach(([r,c])=>{
            board[r][c] = '';
            score += 10;
        });
        scoreEl.innerText = '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ' + score;
        collapseBoard();
    }
    return matchFound;
}

// ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Å‡∏ß‡∏≤‡∏î‡∏ï‡∏Å‡∏•‡∏á‡∏°‡∏≤
function collapseBoard(){
    for(let c=0;c<boardSize;c++){
        let empty = 0;
        for(let r=boardSize-1;r>=0;r--){
            if(board[r][c]==='') empty++;
            else if(empty>0){
                board[r+empty][c] = board[r][c];
                board[r][c] = '';
            }
        }
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏•‡∏π‡∏Å‡∏Å‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
        for(let r=0;r<empty;r++){
            board[r][c] = fruits[Math.floor(Math.random()*fruits.length)];
        }
    }
    renderBoard();
    setTimeout(checkMatches, 200);
}

initBoard();
renderBoard();
</script>

</body>
</html>
