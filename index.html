<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pop Meow Online</title>
<style>
body{
    margin:0;
    height:100vh;
    background: linear-gradient(135deg,#ff9ac2,#ffc0cb);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    font-family:'Fredoka One', cursive;
    cursor:pointer;
    overflow:hidden;
}
img{
    width:280px;
    max-width:80vw;
    margin-bottom:20px;
    transition: transform 0.1s;
}
img:active{transform:scale(0.95);}
.counter{
    font-size:28px;
    font-weight:bold;
    color:#fff;
    text-shadow:1px 1px 3px #333;
    margin-bottom:15px;
}
select{
    margin-top:10px;
    padding:8px 12px;
    border-radius:12px;
    font-size:16px;
    border:none;
}
.board{
    margin-top:20px;
    background: rgba(255,255,255,0.9);
    padding:15px;
    border-radius:20px;
    width:300px;
    text-align:center;
    font-weight:bold;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
}
</style>
</head>
<body>

<img id="img" src="https://cdn.jsdelivr.net/gh/teekmp/popcat-demo/closed.png">

<div class="counter">ğŸŒ à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: <span id="total">0</span></div>

<select id="country">
    <option value="TH">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
    <option value="JP">ğŸ‡¯ğŸ‡µ à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™</option>
    <option value="US">ğŸ‡ºğŸ‡¸ à¸­à¹€à¸¡à¸£à¸´à¸à¸²</option>
    <option value="KR">ğŸ‡°ğŸ‡· à¹€à¸à¸²à¸«à¸¥à¸µ</option>
</select>

<div class="board" id="board">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase config à¸‚à¸­à¸‡à¸„à¸¸à¸“
const firebaseConfig = {
  apiKey: "AIzaSyDcIZWpulJ7PaXpkwFcv2xlgt02W0XqMYI",
  authDomain: "popmeow-43a63.firebaseapp.com",
  projectId: "popmeow-43a63",
  storageBucket: "popmeow-43a63.appspot.com",
  messagingSenderId: "636808933527",
  appId: "1:636808933527:web:23f3f5226ee0dab1e5f9d2",
  measurementId: "G-VL4SH88YBP"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const img = document.getElementById("img");
const totalEl = document.getElementById("total");
const boardEl = document.getElementById("board");
const countrySelect = document.getElementById("country");

const imgClosed = "https://cdn.jsdelivr.net/gh/teekmp/popcat-demo/closed.png";
const imgOpen = "https://cdn.jsdelivr.net/gh/teekmp/popcat-demo/open.png";

const docRef = db.collection("popMeow").doc("global");

// à¸ªà¸£à¹‰à¸²à¸‡ doc à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ
docRef.get().then(docSnap=>{
    if(!docSnap.exists){
        docRef.set({ total:0, countries:{TH:0,JP:0,US:0,KR:0} });
    }
});

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸à¸”
function pop(){
    img.src = imgOpen;
    setTimeout(()=> img.src=imgClosed, 80);

    docRef.update({
        total: firebase.firestore.FieldValue.increment(1),
        [`countries.${countrySelect.value}`]: firebase.firestore.FieldValue.increment(1)
    });
}

// à¸à¸”à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸™à¹‰à¸²
document.body.addEventListener("mousedown", pop);
document.body.addEventListener("touchstart", pop);

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ tween à¸™à¸±à¸šà¸ªà¸¡à¸¹à¸—
function animateCount(el, newVal){
    let current = parseInt(el.textContent.replace(/,/g,'')) || 0;
    const diff = newVal - current;
    if(diff===0) return;
    const duration = 300;
    const steps = 20;
    let step = 0;
    const interval = setInterval(()=>{
        step++;
        el.textContent = Math.floor(current + diff*(step/steps));
        if(step>=steps) clearInterval(interval);
    }, duration/steps);
}

// à¹€à¸£à¸µà¸¢à¸¥à¹„à¸—à¸¡à¹Œ
docRef.onSnapshot(docSnap=>{
    const data = docSnap.data();
    animateCount(totalEl, data.total);
    boardEl.innerHTML = `
    ğŸŒ à¸„à¸°à¹à¸™à¸™à¸•à¸²à¸¡à¸›à¸£à¸°à¹€à¸—à¸¨<br>
    ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢: ${data.countries.TH}<br>
    ğŸ‡¯ğŸ‡µ à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™: ${data.countries.JP}<br>
    ğŸ‡ºğŸ‡¸ à¸­à¹€à¸¡à¸£à¸´à¸à¸²: ${data.countries.US}<br>
    ğŸ‡°ğŸ‡· à¹€à¸à¸²à¸«à¸¥à¸µ: ${data.countries.KR}
    `;
});
</script>

</body>
</html>
